### tá»± há»c NodeJS!! 
- video 32 success

# ğŸ“„ Copyright

All content in the LianHarman repository is copyrighted by the author.  

Â© 2025 [...] â€” All rights reserved.
- You are allowed to use this source code for personal or educational purposes.
- Commercial use or redistribution is not allowed without explicit written permission from the author.




## ğŸ”— Links contact me

[![Facebook](https://img.shields.io/badge/Facebook-1877F2?style=for-the-badge&logo=facebook&logoColor=white)](https://www.facebook.com/thuan.lien.79/)
[![GitHub](https://img.shields.io/badge/GitHub-181717?style=for-the-badge&logo=github&logoColor=white)](https://github.com/LienThuan9697)
[![Email](https://img.shields.io/badge/Gmail-D14836?style=for-the-badge&logo=gmail&logoColor=white)](mailto:lienthuan2004@gmail.com)
[![X (Twitter)](https://img.shields.io/badge/X-000000?style=for-the-badge&logo=twitter&logoColor=white)](https://x.com/harmanlian?s=21)


## Deployment

To project setup

```bash
  npm install
```

To deploy this project run

```bash
  npm start
```


## ğŸ“ŒGit code documentation i have with Vietnamese language
`lÆ°u Ã½: -m kiá»ƒm tra trÆ°á»›c má»›i thá»±c hiá»‡n trong khi -M thá»±c hiá»‡n mÃ  khÃ´ng cáº§n kiá»ƒm tra báº±ng cÃ¡ch ghi Ä‘Ã¨ trá»±c tiáº¿p !!!`

    -m  # DÃ¹ng Ä‘á»ƒ thÃªm thÃ´ng Ä‘iá»‡p commit
    -M  # Ghi Ä‘Ã¨ nhÃ¡nh cÅ©, sá»­ dá»¥ng cáº©n tháº­n!
    -u  # Thiáº¿t láº­p upstream khi push/pull
    -v  # Hiá»‡n chi tiáº¿t quÃ¡ trÃ¬nh thá»±c hiá»‡n
    -b  # Táº¡o nhÃ¡nh má»›i vÃ  chuyá»ƒn ngay sang nhÃ¡nh Ä‘Ã³

___

**`# clone dá»± Ã¡n vá» tá»« github cÃ³ sáº³n:`**
```bash
    git clone https://github.com/username/repository.git
```
___

**`# Äiá»u hÆ°á»›ng Ä‘áº¿n thÆ° má»¥c dá»± Ã¡n`**
```bash
    cd path/to/your/project
```
___

**`# Khá»Ÿi táº¡o kho lÆ°u trá»¯ Git `**
```bash
    git add .
```
___

**`# Cam káº¿t cÃ¡c thay Ä‘á»•i`**
```bash
    git commit -m "Initial commit"
```
___

**`# ThÃªm kho lÆ°u trá»¯ GitHub lÃ m remote repository(káº¿t ná»‘i vá»›i dá»± Ã¡n cÃ³ trÃªn git)`**
```bash
    git remote add origin â€https://github.com/username/repository.gitâ€
```
___

**`# kiá»ƒm tra nhÃ¡nh hiá»‡n táº¡i`**
```bash
    git branch
```
___

**`# náº¿u tÃªn nhÃ¡nh cá»§a báº¡n lÃ  master thay vÃ¬ main, báº¡n cáº§n Ä‘á»•i tÃªn nhÃ¡nh thÃ nh main`**
```bash
    git branch -M main
```
___


**`# XÃ³a NhÃ¡nh `**  
**`VÃ­ dá»¥: xÃ³a nhÃ¡nh master`**
```bash
    git push origin --delete master
```
___

**`# Äáº©y mÃ£ lÃªn GitHub`**
```bash
    'git push -u origin main' hoáº·c 'git push origin main' náº¿u muá»‘n ghi Ä‘Ã¨ hoáº·c thay tháº¿ táº¥t cáº£ thÃªm '--force' vÃ o sau chá»¯ 'main'
```
___

**`# Äá»•i tÃªn nhÃ¡nh tá»« master sang main`**
```bash
    git branch -M <tÃªn_cÅ©> <tÃªn_má»›i>  -> "vÃ­ dá»¥: git branch -M master main"
```
___

**`# Táº¡o nhÃ¡nh má»›i nhanh vÃ  chuyá»ƒn sang nhÃ¡nh Ä‘Ã³ luÃ´n`**
```bash
    git checkout -b â€˜tÃªn nhÃ¡nh má»›iâ€™  ==> `-b lÃ  branch tá»©c lÃ  táº¡o nhÃ¡nh má»›i`
```
___

**`# Check code táº¡i qua tÃªn nhÃ¡nh Ä‘Ã³`**
```bash
    git checkout  â€˜tÃªn nhÃ¡nh checkâ€™
```
___

**`# quay láº¡i code cÅ© vá»›i má»™t commit báº±ng mÃ£ commit hash-ID`**
```bash
    git checkout â€˜HashIDâ€˜
```
___

**`# Äá»ƒ quay láº¡i commit cÅ© ta cÃ³`**  
1 xem lá»‹ch sá»­ commit: 
```bash
    git log
```
2 Chá»n commit muá»‘n quay láº¡i mÃ  khÃ´ng xÃ³a cÃ¡c commit khÃ¡c:
```bash
    git revert [id-commit]
```
`Hoáº·c` quay láº¡i vÃ  xÃ³a commit khÃ¡c:
```bash
    git revert --hard [id-commit]
```
**`- lÆ°u Ã½: quay láº¡i commit khÃ´ng Ä‘á»“ng nghÄ©a remote trÃªn git cÅ©ng quay láº¡i theo, nÃ³ váº«n náº±m á»Ÿ Ä‘Ã³ báº¡n chá»‰ cÃ³ thá»ƒ thá»±c hiá»‡n thá»§ cÃ´ng !!`**

___

**`# Coming soon ğŸ§ `**
```bash
    let's wait ğŸš€
```
___

## Táº¡o BackEnd cÆ¡ báº£n:
**`táº¡o package quáº£n lÃ½ npm`**
```bash
    npm init
```
___

## Táº£i thÆ° viá»‡n:
**`Táº£i thÆ° viá»‡n Express cho Backend`**
```bash
    npm i --save-exact express
```

- Ä‘á»ƒ cháº¡y dá»± Ã¡n nÃ y dÃ¹ng cÃ¢u lá»‡nh: `node app.js`
___

## Setup TypeScript cho dá»± Ã¡n Node.js:
**`Báº£n cháº¥t cá»§a viá»‡c setup TypeScript`**  
1. Báº¡n coding báº±ng cÃº phÃ¡p cá»§a TypeScript: má»¥c Ä‘Ã­ch lÃ  code Ä‘Æ°á»£c gá»£i Ã½, vÃ  code Ã­t lá»—i hÆ¡n  
2. Báº¡n cáº§n sá»­ dá»¥ng thÆ° viá»‡n Ä‘á»ƒ dá»‹ch code tá»« typescript sang javascript  
3. Node.js sáº½ thá»±c thi code Ä‘Ã£ dá»‹ch (javascript)  

`BÆ°á»›c 1: CÃ i Ä‘áº·t thÆ° viá»‡n:`
```bash
    npm i --save-exact --save-dev typescript @types/express @types/node
```
ThÆ° viá»‡n typescript, giÃºp dá»‹ch code typescript, sang code javascript  
ThÆ° viá»‡n @types/express, giÃºp báº¡n coding Express Ä‘Æ°á»£c gá»£i Ã½ code  
ThÆ° viá»‡n @types/node giÃºp báº¡n coding nodejs Ä‘Æ°á»£c gá»£i Ã½ code  

vÃ  Ä‘á»•i Ä‘uÃ´i file app.js thÃ nh .ts

`BÆ°á»›c 2: Cáº¥u hÃ¬nh typescript:`
```bash
    npx tsc --init
```
táº¡o file: `tsconfig.json` táº¡i root
```bash
    {
        "compilerOptions": {
            "module": "commonjs",
            "esModuleInterop": true,
            "target": "es6",
            "sourceMap": true,
            "skipLibCheck": true,
            "outDir": "dist"
        }
    }
```

//giáº£i thÃ­ch Ã½ nghÄ©a
ğŸ”— [Chi tiáº¿t, tham kháº£o](https://www.typescriptlang.org/docs/handbook/tsconfig-json.html)

`BÆ°á»›c 3: Dá»‹ch code TypeScript sang JavaScript`
```bash
    npx tsc
```

`BÆ°á»›c 4: Cháº¡y dá»± Ã¡n`
```bash
    node dist/app.js
```
___


## Setup Typescript
**`setup thÃªm cho dá»± Ã¡n`**

Update `tsconfig.json`
```bash
    "rootDir": "src",
```

update `package.json`
```bash
    "scripts": {
        "test": "echo \"Error: no test specified\" && exit 1",
        "start": "tsc && node dist/app.js",
        "dev": "tsc && node dist/app.js"
    }
```

Cháº¡y dá»± Ã¡n vá»›i cÃ¢u lá»‡nh:
```bash
    npm run dev
```
hoáº·c 
```bash 
    npm start
```
___


## Setup DevTool:
**`Má»¥c tiÃªu: cháº¡y project táº¡i cháº¿ Ä‘á»™ â€˜watchâ€™. Má»—i láº§n cÃ³ file thay Ä‘á»•i, project sáº½ tá»± Ä‘á»™ng cháº¡y láº¡i`**
//TÃ i liá»‡u:  
ğŸ”— [tham kháº£o 1](https://www.npmjs.com/package/nodemon)  

CÃ i Ä‘áº·t thÆ° viá»‡n
```bash
    npm i --save-exact --save-dev nodemon ts-node dotenv
    npm i --save-exact dotenv
```

thÃªm cáº¥u hÃ¬nh nÃ y sao khi cÃ i thÆ° viá»‡n cho Backend vÃ o file `package.json`:
```bash
    "nodemonConfig": {
        "watch": ["src"],
        "ext": "ts",
        "exec": "ts-node ./src/app.ts",
        "ignore": ["dist", "node_modules"]
    },
```
vÃ  Ä‘á»•i scripts trong file `package.json` thÃ nh nhÆ° sau:
```bash 
    "scripts": {
        "test": "echo \"Error: no test specified\" && exit 1",
        "start": "nodemon",
        "dev": "nodemon"
    },
```

táº¡o file `.env` vÃ  cáº¥u hÃ¬nh trong file app.ts thÃªm thÆ° viá»‡n nÃ y vÃ´ 
___

## Cáº¥u hÃ¬nh EJS cho project (tá»©c giao diá»‡n cho backend Ä‘á»ƒ cháº¡y mÃ´ hÃ¬nh SSR)
**`Template: tá»©c lÃ  bá»™ khung Ä‘á»‹nh hÃ¬nh sáºµn vÃ­ dá»¥ template wedding cháº³ng háº¡n, ngÆ°á»i bÃ¡n hÃ ng Ä‘Æ°a sáºµn template, báº¡n chá»‰ cáº§n chá»n vÃ  fill tÃªn vÃ o thÃ´i.`**

ğŸ”— [tham kháº£o](https://expressjs.com/en/guide/using-template-engines.html)  

cÃ i Ä‘áº·t EJS cho backend:
```bash
    npm i --save-exact ejs
    npm i --save-exact --save-dev @types/ejs

```
táº¡o thÃªm folder cho views vÃ  file vá»›i tÃªn mong muá»‘n:
Ä‘á»ƒ hiá»ƒn thá»‹ ná»™i dung file Ä‘Ã³ lÃªn giao diá»‡n web cáº§n khai bÃ¡o tÃªn file vÃ  nguá»“n cá»§a file!
nÃ³ sáº½ Ä‘Æ°á»£c hiá»ƒn báº±ng phÆ°Æ¡ng thá»©c get cá»§a express qua res:
```bash 
    app.set('view engine', 'ejs');
    app.set('views', __dirname + '/views');

    app.get('/', (req,res) => {
        res.render('home.ejs');
    });
```
___

# MÃ´ hÃ¬nh MVC vÃ  File static
**`MVC lÃ  viáº¿t táº¯t cá»§a Model - View - Controlle`**
giÃºp viáº¿t code theo tá»• chá»©c, dá»… dÃ ng báº£o trÃ¬ (maintain) vÃ  má»Ÿ rá»™ng (scale) á»©ng dá»¥ng.  

- Tá»• chá»©c thÆ° má»¥c cho dá»± Ã¡n  
`Táº¡o controllers`  
`Táº¡o models`  
`Táº¡o services`  
`Táº¡o routes`  

(táº¡o route)[https://expressjs.com/en/guide/routing.html]  

Táº¡o thÃªm cÃ¡c thÆ° má»¥c nhÆ° models, routes, controllers vÃ  services Ä‘á»ƒ cáº¥u hÃ¬nh dá»± Ã¡n theo MVC.  
Trong folder routes táº¡o 1 file `web.ts` cho dá»± Ã¡n vá»›i cÃ¡c url cá»§a trang web.
```bash
    import express, {Express} from 'express';

    const router = express.Router();

    const webroutes = (app: Express) => {

        router.get('/', (req, res) => {
            res.render('home.ejs');
        });

        router.get('/about', (req, res) => {
            res.send('About page this BackEnd !');
        });

        app.use('/' , router);
    }
    export default webroutes;

```
thay vÃ¬ pháº£i rander trá»±c tiáº¿p trong file `app.ts` ta chá»‰ cáº§n rander cÃ¡c url cá»§a nÃ³ trong file nÃ y giÃºp ta dá»… dÃ ng quáº£n lÃ­ hÆ¡n !

1. Sá»­a láº¡i ná»™i dung trong file `app.ts`:  
`thay ná»™i dung dÆ°á»›i nÃ y`
```bash 
    router.get('/', (req, res) => {
        res.render('home.ejs');
    });
```
2. thÃ nh nhÆ° nÃ y
```bash
    webroutes(app);
```
3. vÃ  import file `web.ts` vÃ o trong `app.ts`:
```bash
    import webroutes from './routes/web';
```
Sau cÃ¡c bÆ°á»›c trÃªn ta táº¡o thÃªm thÆ° má»¥c `public` Ä‘á»ƒ lÃ m nÆ¡i lÆ°u static File.  
bÃªn trong code `app.ts` cáº§n thÃªm dÃ²ng code bÃªn dÆ°á»›i Ä‘á»ƒ nÃ³ cÃ³ thá»ƒ Ä‘á»c Ä‘Æ°á»£c cÃ¡c file cá»§a thÆ° má»¥c `public`:  
```bash 
    app.use(express.static('public'));
```
___

## Táº£i thÆ° viÃªn Tsconfig_paths
**`dÃ¹ng thÆ° viá»‡n nÃ y Ä‘á»ƒ thay Ä‘á»•i Ä‘Æ°á»ng link absolute paths thÃ nh Relative Path `**

táº£i thÆ° viá»‡n báº±ng code bÃªn dÆ°á»›i:
```bash
    npm i --save-dev --save-exact tsconfig-paths
```
bá»• sung thÃªm cÃ¡c dÃ²ng lá»‡nh bÃªn dÆ°á»›i Ä‘á»ƒ cÃ³ thá»ƒ láº¥y Ä‘Æ°á»£c cÃ³ file theo Ä‘Æ°á»ng dáº«n khi khai bÃ¡o cho cÃ¡c file.

```bash 
    "baseUrl": ".", 
    "paths": {
      "config/*":["./src/config/*"],
      "controllers/*" : ["./src/controllers/*"],
      "models/*" : ["./src/models/*"],
      "routes/*" : ["./src/routes/*"], 
      "services/*" : ["./src/services/*"],
      "views/*" : ["./src/views/*"],    
    },
```

vÃ  bá»• sung thÃªm code cho file `package.jon`:
```bash 
    "exec": "ts-node -r tsconfig-paths/register ./src/app.ts",
```


___

## ThÃªm thÆ° viá»‡n SQL2
**`thao tÃ¡c vá»›i database mysql`**

cÃ i thÆ° viá»‡n sql2:
```bash 
    npm i --save-exact mysql2
```
táº¡o thÃªm thÆ° má»¥c `config` vÃ  file `db.ts` Ä‘á»ƒ káº¿t ná»‘i vá»›i database   
trong file `db.ts` cÃ³ cÃ¡c thÃ´ng tin sau Ä‘á»ƒ káº¿t ná»‘i vá»›i database:
```bash
    import mysql from 'mysql2/promise'

    const GetConnection = async () =>{
        const connection = await mysql.createConnection({
            port: 3306,
            host: 'your host ',
            user: ' name user ',
            password: ' your password',
            database:' your database',
        });
        // A simple SELECT query
        try {
            const [results, fields] = await connection.query(
                'SELECT * FROM `User`'
            );

            console.log(results); // results contains rows returned by server
            console.log(fields); // fields contains extra meta data about results, if available
        } catch (err) {
            console.log(err);
        };
        return connection;
    };

    export default GetConnection;
```

### CÃ i ORM Prisma cho mÃ´i trÆ°á»ng.

- 1 cÃ i thÆ° viá»‡n prima cho dá»± Ã¡n:
```bash
    npm i --save-dev --save-exact prisma
```
- 2 cÃ i luÃ´n extention prisma cho IDE visual code Ä‘á»ƒ Ä‘Æ°á»£c gá»£i Ã½ code trong quÃ¡ trÃ¬nh coding

- 3 sau cÃ¡c bÆ°á»›c trÃªn ta tiáº¿n hÃ nh setup prisma cho dá»± Ã¡n cÃ¡ nhÃ¢n:
Ä‘á»ƒ xem táº¥t cáº£ cÃ¡c cÃ¢u lá»‡nh mÃ  prisma há»— trá»£:
    ```bash 
        npx prisma
    ```
    Ä‘á»ƒ prisma táº¡o 1 file lÆ°u code database Ä‘á»ƒ quáº£n lÃ½ database, dÃ¹ng cá»©u phÃ¡p sau:
    ```bash
        npx prisma init
    ```
    nÃ³ sáº½ táº¡o ra 1 folder prisma cÃ³ file schema vÃ  1 file .env Ä‘á»ƒ lÆ°u Ä‘Æ°á»ng dáº«n Ä‘áº¿n database káº¿t ná»‘i.
    trong file schema láº¥y tÃªn database theo cá»©u phÃ¡p prisma Ä‘Æ°a "[prisma](https://www.prisma.io/docs/getting-started/setup-prisma/add-to-existing-project/relational-databases/connect-your-database-typescript-mysql)"

    ```bash
        // This is your Prisma schema file,
        // learn more about it in the docs: https://pris.ly/d/prisma-schema

        // Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
        // Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

        generator client {
        provider = "prisma-client-js"
        }

        datasource db {
        provider = "mysql"
        url      = env("DATABASE_URL")
        }
    ```
    vÃ  file .env setup nhÆ° tÃ i liá»‡u cá»§a "[prisma](https://www.prisma.io/docs/getting-started/setup-prisma/add-to-existing-project/relational-databases/connect-your-database-typescript-mysql)"

    ```bash
        NODE_ENV=development
        PORT = 8080
        # This was inserted by `prisma init`:
        # Environment variables declared in this file are automatically made available to Prisma.
        # See the documentation for more detail: https://pris.ly/d/prisma-schema#accessing-environment-variables-from-the-schema

        # Prisma supports the native connection string format for PostgreSQL, MySQL, SQLite, SQL Server, MongoDB and CockroachDB.
        # See the documentation for all the connection string options: https://pris.ly/d/connection-strings

        DATABASE_URL="mysql://USER:PASSWORD@HOST:PORT/DATABASE"
    ```

- 4 sau khi setup táº¥t cáº£ cÃ¡c bÆ°á»›c trÃªn thÃ¬ cáº§n cÃ¡i prisma client Ä‘á»ƒ nÃ³ thao tÃ¡c vá»›i database:
    ```bash
        npm i @prisma/client
    ```
# cÃ¡c má»‘i quan há»‡ trong "[Prisma](https://www.prisma.io/docs/orm/prisma-schema/data-model/relations/one-to-one-relations)"
  

# Cáº­p nháº­t code cho typescript cá»§a prisma:
- 1 Ä‘á»ƒ Ä‘Æ°á»£c gá»£i Ã½ code khi cáº­p nháº­t láº¡i database cÃ³ cÃ¢u lá»‡nh sao:
    ```bash
        npx prisma generate
    ```
- 2 Ä‘á»ƒ Ä‘Æ°a code trong file `schema.prisma` Ä‘á»ƒ táº¡o báº£ng vÃ o database:
    ```bash
        npx prisma db push
    ```
- 3 kÃ©o cÃ¡c báº£ng( hoáº·c láº¥y cáº¥u trÃºc báº£ng Ä‘ang cÃ³ trong database Ä‘á»ƒ ghi vÃ o file `schema.prisma` Ä‘á»ƒ táº¡o thÃ nh code khung. ) vá» file `schema.prisma`
    ```bash
        npx prisma db pull
    ```

- 4 Ä‘Æ°a code Ä‘Ã³ vÃ o database Ä‘á»“ng thá»i táº¡o migrate cho prisma Ä‘á»ƒ lÆ°u láº¡i lá»‹ch sá»­ cáº­p nháº­t code cá»§a database ( lÆ°u Ã½: code khung sá»‘ 2 pháº£i cÃ³ trÆ°á»›c má»›i cháº¡y Ä‘Æ°á»£c lá»‡nh nÃ y ).
    ```bash
        npx prisma migrate dev --name "tÃªn pháº§n cáº­p nháº­t Ä‘Ã³"
    ```

# Pagination with "[Prisma](https://www.prisma.io/docs/orm/prisma-client/queries/pagination)":
  

- prisma it take keyword 'limit' and 'offset' replace with limit->take, offset->skip
- recipe take number skip: " Page * PageSize "
- With take you pass in as much as you want.


### Middleware cá»§a multer.ts
```bash
    import multer from 'multer'
    import path from 'path'
    import { v4 } from 'uuid';


    const fileUploadMiddleware = (fieldName: string /* tÃªn trÆ°á»ng file */, dir: string = 'images' /* thÆ° má»¥c lÆ°u trá»¯ */) => {
        return multer({
            storage: multer.diskStorage({
                destination: 'public/' + dir,// cáº¥u hÃ¬nh ná»›i lÆ°u trá»¯ file vá»›i thÆ° má»¥c public vÃ  dir lÃ  thÆ° má»¥c con
                filename: (req, file, cb) => {
                    const extension = path.extname(file.originalname); // láº¥y pháº§n má»Ÿ rá»™ng cá»§a file
                    cb(null, v4() + extension); // táº¡o tÃªn file duy nháº¥t báº±ng cÃ¡ch sá»­ dá»¥ng uuid
                }
            }),
            limits: {
                fileSize: 1024 * 1024 * 3 //3MB - giá»›i háº¡n kÃ­ch thÆ°á»›c file
            },
            fileFilter: (req: Express.Request, file: Express.Multer.File, cb: Function) => {
                if (
                    file.mimetype === 'image/png' ||
                    file.mimetype === 'image/jpg' ||
                    file.mimetype === 'image/jpeg' // kiá»ƒm tra loáº¡i file
                ) {
                    cb(null, true); // cho phÃ©p file náº¿u loáº¡i há»£p lá»‡
                } else {
                    cb(new Error('Only JPEG and PNG images are allowed.'), false);
                }
            }
        }).single(fieldName); // sá»­ dá»¥ng single Ä‘á»ƒ upload má»™t file duy nháº¥t


    }
    export default fileUploadMiddleware;
```

# CÃ i thÆ° viá»‡n Json Web Token cho sever há»— trá»£ xÃ¡c thá»±c ngÆ°á»i dÃ¹ng.
```bash
    npm i --save-exact jsonwebtoken @types/jsonwebtoken
```
and
```bash
    npm i --save-exact --save-dev @types/jsonwebtoken
```
tÃ i liá»‡u tham kháº£o [JsonWebToken](https://www.npmjs.com/package/jsonwebtoken)
- jwt.sign(payload, secretOrPrivateKey, [options, callback])
  - payload: lÃ  dá»¯ liá»‡u gá»­i lÃªn kÃ¨m request.
  - secretOrPrivateKey: lÃ  chá»¯ kÃ½ mÃ  sever kÃ½ Ä‘á»ƒ chá»‰ sever Ä‘Ã³ giáº£i mÃ£ Ä‘Æ°á»£c token nÃ y
  - [options, callback]: á»Ÿ Ä‘Ã¢y cÃ³ thá»ƒ chuyá»n vÃ o thá»i gian háº¿t háº¡n cá»§a key token Ä‘Ã³ { expiresIn: "1d" } 1d á»Ÿ Ä‘Ã¢y Ä‘Æ°á»£c ghi theo cÃº phÃ¡p cá»§a thÆ° viá»‡n vercel Ä‘Æ°á»£c ghi rÃµ trong tÃ i liá»‡u trÃªn.

# Táº¡o 1 middleware Ä‘á»ƒ xÃ¡c thá»±c thÃ´ng tin ngÆ°á»i dÃ¹ng vá»›i token gá»­i lÃªn header cá»§a req
- file middleware cÃ³ tÃªn **[jwt.middleware.ts](https://gitlab.com/LienThuan9697/nodejs_express/-/blob/master/src/middleware/jwt.middleware.ts?ref_type=heads)** cÃ³ ná»™i dung nhÆ° sau:
    ```bash
        import { Request, Response, NextFunction } from "express";
        import jwt from 'jsonwebtoken';
        import "dotenv/config"; // Load environment variables from .env file

        const checkValidJWT = (req: Request, res: Response, next: NextFunction) => {
            const path = req.path; // Láº¥y Ä‘Æ°á»ng dáº«n cá»§a request hiá»‡n táº¡i
            const whitelistPaths = [ // ThÃªm cÃ¡c endpoint cÃ´ng khai khÃ¡c Ä‘á»ƒ khÃ´ng cáº§n check JWT vÃ o Ä‘Ã¢y náº¿u cáº§n
                '/add-product-to-cart',
                '/login',
            ];
            const isWhitelisted = whitelistPaths.includes(path);
            console.log(`Request path: ${path}, isWhitelisted: ${isWhitelisted}`);
            if (isWhitelisted === true) {
                next(); // Náº¿u Ä‘Æ°á»ng dáº«n náº±m trong whitelist, bá» qua kiá»ƒm tra JWT
                return;
            };

            const token = req.headers.authorization; // Láº¥y token tá»« header Authorization cá»§a request
            if (!token || !token.startsWith('Bearer ')) { // Kiá»ƒm tra token cÃ³ tá»“n táº¡i vÃ  Ä‘Ãºng Ä‘á»‹nh dáº¡ng Bearer khÃ´ng
                res.status(401).json({ message: 'Unauthorized: No token provided' });
                return;
            } else {
                try {
                    const jwtToken = token.split(' ')[1]; // Láº¥y pháº§n token sau "Bearer "
                    const dataDecoded: any = jwt.verify(jwtToken, process.env.JWT_SECRET_KEY as string); // Giáº£i mÃ£ token sá»­ dá»¥ng secret key tá»« biáº¿n mÃ´i trÆ°á»ng .env
                    console.log("Decoded JWT data:", dataDecoded);
                    req.UserJWT = { //UserJWT nÃ y Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong src/types/index.dt.ts 
                        id: dataDecoded.id ?? dataDecoded.userId ?? 0,
                        fullName: dataDecoded.fullName ?? '',
                        email: dataDecoded.email ?? '',
                        avatar: dataDecoded.avatar ?? '',
                        roleId: dataDecoded.roleId ?? 0,
                        roleName: dataDecoded.roleName ?? '',
                        accountType: dataDecoded.accountType ?? '',
                    };
                    next(); // Tiáº¿p tá»¥c xá»­ lÃ½ request 
                } catch (error) {
                    console.error("JWT verification error:", error instanceof Error ? error.message : ''); // Ghi log lá»—i xÃ¡c thá»±c JWT cá»¥ thá»ƒ
                    res.status(401).json({ message: 'Unauthorized: Invalid token', error: error instanceof Error ? error.message : '', data: null }); // Pháº£n há»“i lá»—i xÃ¡c thá»±c JWT
                };
            };
        };

        export { checkValidJWT };
    ```
tÃ i liá»‡u tham kháº£o [JsonWebToken](https://www.npmjs.com/package/jsonwebtoken)
- jwt.verify(token, secretOrPublicKey, [options, callback])
  - token lÃ  key lÃºc Ä‘áº§u mÃ£ hÃ³a dá»¯ liá»‡u.
  - secretOrPrivateKey lÃ  chá»¯ kÃ½ mÃ  sever kÃ½ Ä‘á»ƒ chá»‰ sever Ä‘Ã³ giáº£i mÃ£ Ä‘Æ°á»£c token nÃ y

- Äá»ƒ Ä‘á»‹nh nghÄ©a Ä‘Æ°á»£c biáº¿n UserJWT nhÆ° trÃªn ta cÃ³ code tham kháº£o sau:
Táº¡o kiá»ƒu dá»¯ liá»‡u má»›i vÃ  Ä‘á»‹nh nghÄ©a nÃ³ Ä‘á»ƒ dÃ¹ng Ä‘Æ°á»£c trong pháº§n req cá»§a express
    ```bash
        type UserJWT = { // Äá»‹nh nghÄ©a kiá»ƒu cho dá»¯ liá»‡u UserJWT
            id: number;
            fullName: string;
            email: string;
            avatar: string;
            roleId: number;
            accountType: string;
        };
        export type { UserJWT }; // Xuáº¥t kiá»ƒu UserRole vÃ  UserJWT
        declare global {
        namespace Express {
                interface Request { // Má»Ÿ rá»™ng Request Ä‘á»ƒ bao gá»“m UserJWT
                    UserJWT: UserJWT; // UserJWT nÃ y Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a á»Ÿ trÃªn
                }
            }
        };
    ```
    Chi tiáº¿t cÃ³ thá»ƒ tham kháº£o file á»Ÿ **[src/types/index.dt.ts](https://gitlab.com/LienThuan9697/nodejs_express/-/blob/master/src/types/index.dt.ts?ref_type=heads)**

# Build docker compose vá»›i mysql:
- viáº¿t file docker-compose.yaml Ä‘á»ƒ build database báº±ng docker nhÆ° sau:
```bash
version: '3.8' # phiÃªn báº£n docker-compose
services: # Ä‘á»‹nh nghÄ©a cÃ¡c dá»‹ch vá»¥
  db: # tÃªn dá»‹ch vá»¥
    image: mysql:8.0 # sá»­ dá»¥ng image mysql phiÃªn báº£n 8.0
    container_name: DbMysql_LaptopShop_blockchain # tÃªn container
    restart: unless-stopped # tá»± Ä‘á»™ng khá»Ÿi Ä‘á»™ng láº¡i trá»« khi bá»‹ dá»«ng thá»§ cÃ´ng
    environment: # thiáº¿t láº­p biáº¿n mÃ´i trÆ°á»ng
      MYSQL_ROOT_PASSWORD: LianHarman2049 # pass cá»§a user root
      MYSQL_DATABASE: LaptopShopDB # tÃªn database muá»‘n táº¡o
      MYSQL_USER: LianHarman # biáº¿n nÃ y Ä‘áº·t Ä‘á»ƒ táº¡o user má»›i vÃ  cáº¥p quyá»n cho user Ä‘Ã³
      MYSQL_PASSWORD: LianHarman2049 # pass cá»§a user má»›i táº¡o
    ports: # Ã¡nh xáº¡ cá»•ng
      - "3307:3306" # Ã¡nh xáº¡ cá»•ng 3306 trong container ra cá»•ng 3307 trÃªn host
    # volumes: # gáº¯n volume Ä‘á»ƒ lÆ°u trá»¯ dá»¯ liá»‡u
    #   - db_data:/var/lib/mysql # lÆ°u dá»¯ liá»‡u mysql vÃ o volume db_data
    # networks: # Specify the network
    #   - mysql_network
```
- Sau Ä‘Ã³ cháº¡y lá»‡nh sau Ä‘á»ƒ build cÆ¡ sá»Ÿ dá»¯ liá»‡u tá»« file nÃ y(nhá»› má»Ÿ cmd á»Ÿ file nÃ y !):
```bash
docker compose -p ~this_name_container~ up -d
```
docker compose: ÄÃ¢y lÃ  lá»‡nh dÃ¹ng Ä‘á»ƒ cháº¡y docker-compose.yml. NÃ³ sáº½ táº¡o vÃ  quáº£n lÃ½ nhiá»u container cÃ¹ng 1 lÃºc theo cáº¥u hÃ¬nh trong file.

-p: NÃ³ dÃ¹ng Ä‘á»ƒ Ä‘áº·t tÃªn chung cho táº¥t cáº£ nhá»¯ng thá»© mÃ  compose táº¡o ra tá»« TÃªn container,TÃªn network, TÃªn volume (náº¿u cÃ³).

up: Táº¡o container vÃ  cháº¡y chÃºng, Náº¿u container chÆ°a tá»“n táº¡i â†’ Docker sáº½ build vÃ  cháº¡y, Náº¿u container Ä‘Ã£ tá»“n táº¡i â†’ Docker cháº¡y láº¡i.

-d: detached mode (cháº¡y ngáº§m) khÃ´ng chiáº¿m cmd hiá»‡n táº¡i Ä‘ang gÃµ lá»‡nh nÃ y.

 - Sau khi build cÃ³ thá»ƒ kiá»ƒm tra container cÃ³ cháº¡y hay chÆ°a báº±ng lá»‡nh:
 ```bash
 docker ps
```
hoáº·c vÃ o docker Ä‘á»ƒ xem.

- Build Dockerfile cho dá»± Ã¡n nhÆ° tháº¿ nÃ o cÃ³ thá»ƒ xem Docker file cá»§a dá»± Ã¡n nÃ y [Dockerfile](https://github.com/LienThuan04/BlockChain-Dapp/blob/master/Dockerfile).

- cÃ¡ch táº¡o compose dá»± Ã¡n backend nÃ y cÃ¹ng vá»›i database mysql náº±m á»Ÿ Ä‘Ã¢y: [docker-compose.yaml](https://github.com/LienThuan04/BlockChain-Dapp/blob/master/docker/nodejs/docker-compose.yaml).




































## <h3 align="left">Languages and Tools:</h3>

<p align="left"> <a href="https://getbootstrap.com" target="_blank" rel="noreferrer"> <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/bootstrap/bootstrap-plain-wordmark.svg" alt="bootstrap" width="40" height="40"/> </a> <a href="https://www.w3schools.com/css/" target="_blank" rel="noreferrer"> <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/css3/css3-original-wordmark.svg" alt="css3" width="40" height="40"/> </a> <a href="https://www.docker.com/" target="_blank" rel="noreferrer"> <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/docker/docker-original-wordmark.svg" alt="docker" width="40" height="40"/> </a> <a href="https://git-scm.com/" target="_blank" rel="noreferrer"> <img src="https://www.vectorlogo.zone/logos/git-scm/git-scm-icon.svg" alt="git" width="40" height="40"/> </a> <a href="https://www.w3.org/html/" target="_blank" rel="noreferrer"> <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/html5/html5-original-wordmark.svg" alt="html5" width="40" height="40"/> </a> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript" target="_blank" rel="noreferrer"> <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/javascript/javascript-original.svg" alt="javascript" width="40" height="40"/> </a> <a href="https://www.mysql.com/" target="_blank" rel="noreferrer"> <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/mysql/mysql-original-wordmark.svg" alt="mysql" width="40" height="40"/> </a> <a href="https://www.postgresql.org" target="_blank" rel="noreferrer"> <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/postgresql/postgresql-original-wordmark.svg" alt="postgresql" width="40" height="40"/> </a> <a href="https://postman.com" target="_blank" rel="noreferrer"> <img src="https://www.vectorlogo.zone/logos/getpostman/getpostman-icon.svg" alt="postman" width="40" height="40"/> </a> <a href="https://reactjs.org/" target="_blank" rel="noreferrer"> <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/react/react-original-wordmark.svg" alt="react" width="40" height="40"/> </a> <a href="https://redux.js.org" target="_blank" rel="noreferrer"> <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/redux/redux-original.svg" alt="redux" width="40" height="40"/> </a> <a href="https://sass-lang.com" target="_blank" rel="noreferrer"> <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/sass/sass-original.svg" alt="sass" width="40" height="40"/> </a> <a href="https://tailwindcss.com/" target="_blank" rel="noreferrer"> <img src="https://www.vectorlogo.zone/logos/tailwindcss/tailwindcss-icon.svg" alt="tailwind" width="40" height="40"/> </a> </p>